      SUBROUTINE GEODO1( MXDOP,MXDM, MXPS, MYDM, MXDOP2, MXROW, N1, PX,
     1 X, FDI, A, C, V, ANORM,W,  XX, PY, YY,      AMTR1, SK, DOP,ISHRT,
     2 ELEV, KDPSI, NTEST, NAME, PD, PTRP, XS, NDLY, DMET, GEOCO, NBI,
     3LOK,NGR, ELMAX, U, NSEW,NG,VPV,MGR,MRCN,IODD, FSS, WPDC, WPD,
     1SOS,NOD, CFDI, NAP, FVPV, PSC, NSAT,FST,SMTRX ,EPOCH,STWGHT,ISCN)
      IMPLICIT REAL*8 (A-H,O-Z)
      CHARACTER*10 NAME,NDESC
      CHARACTER*4 ISRC
C
C   VERSION: 03/20/83                  GEODOP 5.11 (STDFTN)
C   MODIFIED FOR RUNNING ON IBM FORTRAN (G1 OR Q COMPILERS).
C   B. ARCHINAL, DEPARTMENT OF GEODETIC SCIENCE AND SURVEYING,
C   THE OHIO STATE UNIVERSITY, COLUMBUS, OHIO.
C
C
C   SUBPROGRAMS USED:
C    . . .
C    FORTRAN:        ABS, EXP, INT, SQRT
C
C   MAIN PROGRAM SUBROUTINE
C
C    GEODOP MAIN SUBROUTINE
C
      DIMENSION PX(MXDM,MXDM),X(6,MXPS),GEOCO(3,MXPS),FDI(8,MXPS)  ,
     1 A(MXROW,3 ), C(MXROW,NBI), W( 1), V( 1), ANORM(MXDM,MXDM), U(1 ),
     2 XX(1 ), PY(MYDM,MYDM), YY(1), SK(1), DOP(MXDOP,MXPS), ISHRT(MXDOP
     3,MXPS), NG(1), KDPSI(MXDOP,MXPS), NTEST( 1), NAME( 1),XS(MXDOP2,6)
     1 , PSC(1)
     2, WPD(530),WPDC(1025), SOS(1), NOD(1), DORB(6), ELEV(1)
     1 , VARORB(21)
C
      DIMENSION     PD(1), NDLY(1), DMET(3,MXPS), NGR(1),
     1CHS(30),LOK( 1),DT(4),ORBIT(7),ELMAX(1),DXS(3),CXYZ(10,3),NSEW(1)
     2,AMTR1(1), MGR(1)
     3,     FSS(7), FST(3,17), SMTRX(3,17), STWGHT(6), CFDI(5,MXPS)
     4,     NAP(MXPS), FVPV(MXPS),VPVS(17)
C
C     GEOCA  LATITUDE, LONG. AND HEIGHT
C     X      X,Y,Z, AND TEPRORARY STORAGE AT  ROW  4,5,6
C     FDI   FREQ. OFSET, CONSTRAINT,F-DRIFT, CONSTRAINT , PREVIOUS F.OFF
C
C  COMMON AREAS
C
      REAL *8 ISHRT, LOK
      COMMON /OPT/ ASG,HOR, SIGA,A1,ESQ,DXS, TE,XP99,RT,ALG,ACR, OUT,
     1RHO, FO,XLO, PI, WE, RADG, SGMT, ITTG, ITRIM, IWRT,IOUT,INPT,NROW
C
      COMMON /COUNT/  NGRPTS, MACOL, MCCOL, MROW, IPASSC, IACCC,
     1   IPASS, NREJT, NDFRJ , IELEV ,IVRJ , MDFM ,NPTS , ISEQ , IACC
     1, NORB
C
C
      COMMON /SAT/ LOKR,IMIN,IST,IT2,FS,NSTA,NDP ,CXYZ,DT,BIT,CMIN,
     1  ORBIT,CPA, IORD
C
      COMMON /CHI/ CHS
C--- COMMON BLOCK FOR OSU IWRT OPTIONS.
      COMMON/OSUOPT/IF11SW
C
C  INTERVAL LENGTH IN MIN  AND  C  IN MIN
      DATA DORB/6*0.D0/
      DATA VPVT,XPXT, YPYT/ 'VPV ','XPX ','YPY '/
C     DABS(XX)=ABS(XX)
C     DCOS(XX)=COS(XX)
C     DSIN(XX)=SIN(XX)
C     DSQRT(XX)=SQRT(XX)
      DT(1)=.53678625D 00
      DT(2)=.4601025D 00
      DT(3)=.53678625D 00
      DT(4)=.466328958D 00
C  SAT INTERVAL( MIN) MAX. NO OF INTERVALS
       DTS= .50D0
C  CHECK IF UPDATED FITTED EPHEMERIS ARE REQUIRED
C   A   FOR OUTPUT ON TAPE 4
      IEPH= IWRT -( IWRT/10)*10
      ICPA= ITRIM/1000
      ITRM= (ITRIM-ICPA*1000)/100
      ITRIM= ITRIM- ICPA*1000- ITRM*100
C  MSTA- MIN. NO. OF OBSERVING STATIONS PER PASS.
      MSTA= ITRIM/10
      ITRIM= ITRIM- MSTA*10
C  IF ITRIM EQ 9   SET ITRIM TO 10 I. E. SIMULATION MODE
      IF(ITRIM.EQ.9) ITRIM=10
      IF(MSTA.EQ.0.AND.NPTS.GT.1) MSTA=2
      IF(MSTA.EQ.0) MSTA=1
      IF(MSTA.EQ.9.OR.MSTA.GT.NPTS) MSTA= NPTS
      IF(ITRM.GT. NPTS) ITRM= NPTS
      IF(ITRM.EQ.9) ITRM= NPTS
      SIGM= 1.
      IF(FSS(7).EQ.0.D0) GO TO 15
      EPOCH= FSS(7)
      DO 16 I=1,6
      IF(FSS(I).EQ.0.D0) GO TO 16
      FST(1,I)= FSS(I)
16      CONTINUE
15      CONTINUE
      IACC= IACCC
      IF4=4
      IF7=14
      I7=IF7
      IF11=11
      LOKPR=0
      IORD= IODD
      IT2= MXDOP/8
C   COMPUTE AMTR1 DIMENSION
        N3= MXROW + N1**2+ MYDM + N1*MYDM + 9*MXPS
        N4= MXDOP**2+ 9*MXPS
        IF(N3.LT.N4) N3= N4
        IF(N3.LT.600) N3= 600
      BIT= 0.327708333D-03
      DO 5 IA=1, MXPS
      FDI(6,IA)=0.D0
      FDI(7,IA)=DSQRT(SGMT/PTRP)
      CFDI(4,IA)= FDI(1,IA)
      CFDI(5,IA)= FDI(3,IA)
      FDI(8,IA)= 0.D0
      DO 1 I=1,MXDOP
      L= I-((I-1)/IT2)*IT2
1      ISHRT(I,IA)= DT(L)
C      MGR  ACTUAL NO OF DOPPLERS READ IN
      MGR(IA)= 0
      NGR(IA)=0
      ELMAX(IA)=0.D0
   5  CONTINUE
      ALG= STWGHT(2)
      XP100= 4.47D0 *DSQRT(SIGA)
      NBO= NBI- NORB
      CHSQX= SIGA*CHS(3)
      CHSQY= SIGA*CHS(NBO)
    7  CONTINUE
      ISTOP=1
      IZERO=1
      DVPV=VPV
      DVPV1=DVPV
      ICLW=1
      LOKPR=  LOKR
C
      CALL RINPT(MXPS, MXDOP,NGR,DOP,NDESC,ISHRT,IEND,NAME,KDPSI,NG,
     1 DMET, LOK, NSEW, MGR, INJ, NTEST, LOKPR, ITRM, LOKMN, DTS, MSTA,
     2 FST, EPOCH, JST, ISCN, ISRC)
C
      IF(IEND) 167,167,64
167   XLIM= XP100
      IF(IACC.NE.IACCC) GO TO 19
      LOKPR= LOKR
      LOKPRF=LOKR
19    DTINJ= LOKR- INJ
      IF(DABS(DTINJ).GT.720.D0) DTINJ=0.D0
      PRED= 1.D0+ (DTINJ   /720.D0)**2
      IF(STWGHT(1).LE.5.D0) PRED= 1.D0
C  ISTA- ACTUAL NO OF STATIONS OBSERVED SIMULTANEOUSLY(.LE. MXPS)
      ISTA=0
      DMIN= (LOKR-LOKPR)/1440.D0
      MRW=1
C   RTM   MEAN CORRELATION COEFFICIENT (FOR INTERFEROMETRY)
      RTM= 0.D0
      IF(DMIN.GT.50.D0) DMIN= 0.D0
      M=1
       DTSM= 0.D0
      MDOP=0
      DO 37 I=1, NGRPTS
C--- STORE INITIAL X VALUES IN LAST PART OF ROW OF X.
      DO 3 IB=1,3
3     X(IB+3,I)= X(IB,I)
C  IGNORE STATION IF NTEST=10
       IPX= 3*(M-1) +1
      PXX= SIGM**2/PX(IPX,IPX) + (STWGHT(2)*PRED)**2
      IF(NTEST(I).NE.10) M= M+ 1
C CHECK FOR MINIMUM DATA (2.5 MIN)
      IF(DMIN.NE.0.D0) GO TO 13
      CFDI(2,I )= 0.D0
      FDI(8,I)= LOKR- 1440.D0
      CFDI(1,I)= 1.D0
      CFDI(3,I )=2.25D0
13      CONTINUE
      FDI(1,I)= FDI(1,I) + FDI(3,I)* DMIN*.4D-01
      IMIND= (2.5D0/ISHRT(1,I) +.2D0)
      IF(NGR(I).GE.IMIND) GO TO 17
      MGR(I)= 0
      NGR(I)= 0
17      CONTINUE
      IF( NGR(I).EQ.0) GO TO 37
C    UPDATE APPROXIMATE FREQ-CY FDI
C
      CALL STCORD( ISHRT(1,I),  MXDOP2,X(1,I), NDLY(I), FDI(1,I),  SK,
     1NG,NGR(I),KDPSI(1,I),ELMAX(I),ELEV,XS,LOK(I),GEOCO(1,I),DOP(1,I),V
     1,
     1 NAME(I), MGR(I), NTEST(I), LOKMN,ICPA, DTS,IS)
C
      IF( ELMAX(I).GT. TE) GO TO 6
      MGR(I)= 0
      NGR(I)= 0
      IELEV= IELEV+1
      WRITE(IOUT,151) ELMAX(I), NAME(I), TE, IELEV
      GO TO 37
6      NA= MRW + MGR(I) -  1
      DO 9 IA=MRW,NA
      W(IA)=0.D0
      V(IA)=0.D0
      DO 8 IB=1,NBI
8     C(IA,IB)=0.D0
      DO 9 IB=1,3
9     A(IA,IB)=0.D0
C  APPARENT REC. F-DRIFT (I.E. REC+ SAT DRIFTS)
      FDI(3,I)= FDI(3,I) +FST(2,JST)
      DMNI= (LOKR-FDI(8,I))*1.66667D-03
      SF= CFDI(3,I)*DMNI**2+2.D0*CFDI(2,I)*DMNI+ CFDI(1,I) + 1.D0
      SF=DSQRT(SF)* FDI(2,I)
C
      CALL FORM(NBI,        MXDOP2, MXROW, A, C, W, X(1,I), GEOCO(3,I),
     1 FDI(1,I), SK, DOP(1,I), KDPSI(1,I), ISHRT(1,I),NTEST(I), PD(I),
     2 NAME(I), ELEV, NGR(I), V, DMET(1,I), XS, LOK(I), NDLY(I), MRW,
     , MGR(I), NG, SF, RTO, DTSM, PXX, IS, ITRM,STWGHT(1) )
C   RTO- STATION CORR) COEFICIENT
      RTM= RTM + RTO
      IF(NGR(I).GE.IMIND)  GO TO 26
      MRW= MRW- MGR(I)
      NGR(I)= 0
      MGR(I)= 0
26      CONTINUE
C
      IF(NGR(I).GT.1) ISTA= ISTA +1
      FDI(3,I)= FDI(3,I) -FST(2,JST)
      MDOP= MDOP + NGR(I)
37    CONTINUE
      DTSN= DTS
      IF(MDOP.NE.0) DTS= DTSM/MDOP
      IF(DTS.LT..1D0.OR.DTS.GT.2.D0) DTS= .5D0
      NDD=MXDOP
C     RESET VPV & VPV1 FOR ITERATION
C   CHECK IF ANY DATA LEFT
C  IGNORE THE PASS IF OBSERVED FROM LESS THAN MSTA STATIONS
C   SIMULTANEOUSLY.
      IF(ISTA.LT.MSTA ) GO TO 25
C    RTM  MEAN CORRELATIN COEFFICIENT ( FOR INTERFEROMETRY)
      RTM= RTM/ ISTA
38     CONTINUE
      VPV=DVPV
      VPV1=DVPV1
      NBO= NBI- NORB
      MCCOL= NORB + ISTA*NBO
      MROW= MRW - 1
      DO 10 IA=1,MACOL
      U(IA)=0.D0
      XX(IA)=0.D0
      DO 10 IB=1,MACOL
10    ANORM(IA,IB)=0.D0
      DO 11 I=1,MCCOL
      V(I)=0.D0
      DO 12 J=1,MCCOL
  12   PY(I,J)=0.D0
11    PY(I,I)= PTRP
C  INITILIZE PY MATRIX WITH SAT. COVARIANCES  SEE PYINT FOR MORE DETAILS
      TREF= LOKR
      CALL PYINT(MYDM, MXPS, NGRPTS,NDGF, NBO,NORB, ISTA, NGR,
     1 SGMT, FDI, TREF ,X, PY, AMTR1, CFDI)
      I=  1
      DO 29 I=1, NORB
29      PY(I,I)= SGMT/STWGHT(I)**2/PRED
      IF(NDGF.GT.0) GO TO 147
25      NDFRJ= NDFRJ + 1
      WRITE(IOUT,148) NDFRJ
      GO TO 7
  147 CONTINUE
C
      J1= 1+ N1* MYDM
      J2= J1+ N1**2
C       P H A S E  A D J U S T M E N T  C O M P U T A T I O N
      PSS= SGMT/ACR**2*XLO**2
C  ACCOUNT FOR NOISE INCREASE FOR SAT 12  ( BY SIGMA OF 9 CM)
      IF(IST.EQ.12) PSS= SGMT/(ACR**2+.0081D0)  *XLO**2
C    FORM PSC VECTOR
      CALL MLTP3(XS,PSC, LOK, LOKMN, MGR, ISHRT,MXDOP, KDPSI, NGRPTS,
     1 NSAT, V   , PSS,RTM,PD,XLO, DTS)
C
      CALL ADJST( MXDM, MYDM,       MXROW, PX, A, C, W, U, ANORM, V, XX,
     1PY,YY,VPV,VPV1,PD, AMTR1(J2),AMTR1,AMTR1(J1), N1,MGR,NBI,NTEST
     1 , KDPSI, ISHRT, XS,PSC, LOK, LOKMN, SK, MXPS, MXDOP, NSAT, DTS,
     1  XLO, NGR, VARORB)
C
C    DATA  SCREENING
2     IZERO= 1
      IR=1
C   ITRIM= 10 SIMULATION MODE
      IF(ITRIM.EQ.10) GO TO 22
      ISTA= 0
      J3=    N3 -9*MXPS-MXROW-3
      ISTB=-1
      ISTC= 0
      DO 20 K=1,NGRPTS
       IF(NTEST(K).NE.10) ISTB= ISTB + 1
      IS= IDINT((LOK(K) +.05D0- LOKMN)/DTSN)
      L= MGR(K)
      IF(NGR(K).LE.0) GO TO 20
C  TEST  RESIDUALS  FOR  OUTLAYERS
C
      CALL REJECT(V(IR),KDPSI(1,K),NG,DOP(1,K),MGR(K),IVRJ,XLIM,NGR(K)
     1 ,XPX,ISTOP,IZERO,NAME(K),NBI,IR,MXROW,A,C,W(IR),IS,ITRM,IOUT)
C
C
C     CHECK CONTRIBUTION OF EACH STATION TO VPV
C
      IF(NGR(K).LT.IMIND.OR.IZERO.EQ.0) GO TO 34
      IF(ISTOP.NE.0) GO TO 34
      CHSQV= SIGA*(NGR(K)+ SQRT(2.D0*NGR(K))*XP99)
      IF(NGR(K).LE.30) CHSQV= SIGA*CHS(NGR(K))
      REJCW= VPVT
      IF(XPX.GT.CHSQV) GO TO 27
C  CHECK CONTRIBUTION OF EACH STATION POSITION  TO VPV
      XPX=0.D0
      KK= ISTB*3
      DO 36 I=1,3
      J3= J3 + 3
      DO 36 J=1,3
 36   XPX= XPX + XX(KK+J)*AMTR1(J3+J)*XX(KK+I)
      REJCW= XPXT
      IF(XPX.GT.CHSQX) GO TO 27
C  CHECK CONTRIBUTION OF EACH STATION BIASES TO VPV
      XPX=0.D0
      KNB= NORB + ISTC*NBO
      REJCW= YPYT
      DMNK= (TREF-FDI(8,K))*1.6667D-03
      SFK = (CFDI(3,K)*DMNK**2+2.D0*CFDI(2,K)*DMNK+ CFDI(1,K) +1.D0)*
     +       FDI(2,K)**2
      XPX = YY(KNB+1)**2/SFK*SGMT
      IF(NBO.GE.2) XPX= XPX+ (YY(KNB+2)/FDI(5,K))**2*SGMT
      IF(NBO.GE.3) XPX= XPX+ (YY(KNB+3)/FDI(7,K))**2*SGMT
      IF(NBO.GE.4) XPX= XPX+ (YY(KNB+4)/FDI(4,K))**2*SGMT
      IF(XPX.GT.CHSQY) GO TO 27
      GO TO 34
27    NGR(K) = 0
      WRITE(IOUT,35) REJCW, XPX,  NAME(  K)
35    FORMAT(1H0,6H ++++  , A4,3H = ,F10.3,23H FAILS AT 99% ,STATION ,
     +       A4,16H  REJECTED  ++++)
34    CONTINUE
      IF(NGR(K).GE.IMIND)  GO TO 28
      NGR(K)= 0
      K1= K+ 1
      IF(K1.GT.NGRPTS) GO TO 33
      IRI= IR-1
       DO 32 KK= K1,NGRPTS
      IF(NTEST(KK).EQ.10)  GO TO 32
      L= MGR(KK)
      IF(L.EQ.0)GO TO 32
      DO 30 I=1,L
      IRI= IRI+1
      IRM= IRI+ MGR(K)
      W(IRI)= W(IRM)
      V(IRI)= V(IRM)
      DO 31 J=1,3
31     A(IRI,J)= A(IRM,J)
      DO 30 J=1,NBI
       C(IRI,J)= C(IRM,J)
30      CONTINUE
32      CONTINUE
33     MRW= MRW- MGR(K)
       MGR(K)= 0
28      CONTINUE
      IF(NGR(K).NE.0) ISTA= ISTA+ 1
      ISTC= ISTC + 1
      IR= IR+ MGR(K)
20      CONTINUE
      IF(ISTA .GE.MSTA) GO TO 24
      NDGF= 0
      VPV= DVPV
      VPV1= DVPV1
      GO TO 25
24      CONTINUE
      IF(ISTOP.EQ.0) GO TO 22
      ISTOP=0
      XLIM= XP99
      IF(IZERO.EQ.0) GO TO 38
      GO TO 2
22    IF(IZERO.EQ.0)  GO TO 38
C    VAR. WEIGHTING RT= 2, OR RT= 3
      IF(RT.LT.2.D0.OR.ICLW.GT.1) GO TO 23
      CALL VARWGT( A, C, W,V,SK, XS, RT, KDPSI, ISHRT,NGRPTS, MGR,MXROW,
     1  NBI,MXDOP,MXPS,PD, RTM, ELEV)
      ICLW= ICLW +1
      GO TO 38
23      CONTINUE
C
C
C     UPDATE APPROX. (PREVIOUS) CART. COORDINATES
C     FREQ. OFFSET
C
      IFF=0
C
C     END  ITERATION  LOOP
C
      JROW=1
      WRITE(IOUT,96)
      WRITE(ISCN,96)
      ISTA=1
      DO 47 JK=1,NGRPTS
      IF(NTEST(JK).EQ.10) GO TO 47
      MADOP= MGR(JK)
      JT= NORB + NBO*( ISTA-1)  +1
      IF(ITRIM.EQ.10) GO TO 48
C--- UPDATE THE X VALUES WITH THEIR CORRECTIONS (XX).
      DO 40 ICR=1,3
40    X(ICR,JK)= X(ICR+3,JK) + XX(ICR-1+JROW)
      JROW= JROW +3
48    IF(NGR(JK).NE.0) GO TO 41
      IFF=IFF+1
      GO TO 47
41    FDI(1,JK)= FDI(1,JK) +YY(JT)/60.000D0
      FOFF= FDI(1,JK)
      IDLY=NDLY(JK)
      IF(NBO.GE.2) IDLY= NDLY(JK)+ YY(JT +1)*100.D0
      J=  JT +2
       DTROP=0
      IF(NBO.GE.3)DTROP=FDI(6,JK)*DEXP((FDI(8,JK)-LOK(JK))/360.D0)+YY(J)
      FDT=0.D0
      IF(NBO.GE.4) FDT= YY(J+1)
      LLOK= LOK(JK)
      CALL DIME(LLOK,ID,IH,IMN)
      WRITE(IOUT,95) NAME(JK),IH, IMN, (DMET(JL,JK),JL=1,3),FOFF,IDLY,
     1 DTROP, FDT,ELMAX(JK),(X(JL,JK),JL=1,3), (KDPSI(JL,JK),JL=1,MADOP)
      WRITE(ISCN,95) NAME(JK),IH, IMN, (DMET(JL,JK),JL=1,3),FOFF,IDLY,
     1 DTROP, FDT,ELMAX(JK),(X(JL,JK),JL=1,3), (KDPSI(JL,JK),JL=1,MADOP)
      ISTA= ISTA +1
47    CONTINUE
      OPO= 0.D0
      DO 18 I=1,NORB
      OPO= OPO + YY(I)**2*SGMT/STWGHT(I)**2/PRED
18    DORB(I)= YY(I)
      IF(ITTG.EQ.5) GO TO 175
      WRITE(IOUT,126)
      DO 145 J=1,3
  145 WRITE(IOUT,98)(XX(I*3-3+J),I=1,NGRPTS)
 175  CONTINUE
C     PRINT VECTOR  V
C
      DTVPV=VPV-DVPV
C      COMPUTE NO. OF DEGREES OF FREEDOM
C
C     STATISTICAL TESTING OF VPV (CHI-SQUARE TEST)
C
      IDFM=MDFM
      MDFM=MDFM+NDGF
      IDFM=MDFM-IDFM
      IF (IDFM.LE.0) GO TO 52
      IF(ITRIM.EQ.10) GO TO 54
C  CHECK ORBITAL BIASES
      IF(OPO.GT.(SIGA*CHS(NORB))) WRITE(IOUT,93) OPO
93    FORMAT(1H0,46H **** WARNING  SQUARE SUM OF ORB. BIASES (DO) ,
     + F14.3, 18H FAILS AT 99% ****)
      CHISQ= SIGA*(IDFM+DSQRT(2.D0*IDFM)*XP99)
      IF(IDFM.LE.30) CHISQ= SIGA* CHS(IDFM)
      IF (DTVPV.LE.CHISQ) GO TO 54
C--- PASS REJECTED DUE TO DELTA VTPV (DTVPV) OR D.F. < 0.
52    MMMM=MDFM-IDFM
      DO 53 JK=1,NGRPTS
      DO 51 K=1,3
51    X(K,JK)= X(K+3,JK)
53      CONTINUE
      MDFM=MMMM
      VPV=DVPV
      VPV1=DVPV1
      NREJT=NREJT+1
      WRITE(IOUT,89) DORB, VPV, DTVPV, MDFM, SIGM
      WRITE(IOUT,90) NREJT
      GO TO 7
54    CONTINUE
      TIM= ISHRT(1,1) +.1
C  SUMMATION FOR
C  DOPP VAR COV MATRIX(WPD) AND CROSS  CORRELATION (BETWEEN STATIONS) (W
C
      CALL WEIGHT(V, KDPSI, WPD, MXDOP, MGR, LOK, MXPS, WPDC, SOS ,
     1 NOD )
C
      CALL UPDT( NDLY, FDI, YY, MXPS, CFDI, SMTRX,       NAP, MGR, LOKR,
     2 IST,FVPV, NAME, FST, EPOCH, VPVS, NBO, NGR, DTS)
      SIGM=1.D0
      IF(ITRIM.EQ.10) GO TO 66
      IF(MDFM) 66,66,67
67     SIGM= VPV/MDFM
66    CONTINUE
C
C        ADJUSTMENT
      IO= -N1 +J1 -1
      DO 55 I=1, MACOL
      IO= IO + N1
      DO 55 J= 1, MACOL
      JI= IO + J
55    PX(J,I)= AMTR1(JI)
C  SAVE PREVIOUS PASS WEIGHT COEF. MATRCES FOR XPX TESTING
      J3=  N3-9*MXPS-MXROW- 3
      NGPTS= MACOL/3
      DO 58 II=1,NGPTS
      IIJJ= (II-1)*3
      J33= J3 +3
      DO 56 I=1,3
      J3= J3 + 3
      DO 56 J= 1,3
56    AMTR1(J3+J)= ANORM(IIJJ+I,IIJJ+J)
      CALL TRINN(AMTR1(J33+1),3,2,3)
      AMTR1(J33+2)= AMTR1(J33+4)
      AMTR1(J33+3)= AMTR1(J33+7)
      AMTR1(J33+6)= AMTR1(J33+8)
58    CONTINUE
      IF(ITTG.EQ.5) GO TO 63
      WRITE(IOUT,117)
      DO 57 II= 1, MACOL
57    WRITE(IOUT,125) (PX(II,K),K=II,MACOL )
C
C        ESTIMATION OF VARIANCE COVARIANCE  MATRIX
C
C     WRITE  OUT  RESIDUALS
      WRITE(IOUT,128)
      NGRS=1
      DO 50 I=1,NGRPTS
      IF(MGR(I).EQ.0) GO TO 50
      NGRE= MGR(I) -1  + NGRS
      IF(NGR(I).NE.0) WRITE(IOUT,92) NAME(I), (V(J),J=NGRS,NGRE)
      NGRS=NGRE+ 1
50    CONTINUE
      WRITE(IOUT,91)
63    CONTINUE
      DO 60 JK=1,MACOL
      DO 59 IK=1,MACOL
59    ANORM(JK,IK)=SIGM*ANORM(JK,IK)
      IF(ITTG.NE.5) WRITE(IOUT,125) (ANORM(JK,IK),IK=JK,MACOL)
  60  CONTINUE
      SIGM= DSQRT(SIGM)
      WRITE(IOUT,89)      DORB       , VPV,DTVPV, MDFM, SIGM
      WRITE(ISCN,89)      DORB       , VPV,DTVPV, MDFM, SIGM
C
C     VAR COV OF ORBIT ELEMENTS
C
      IF(IEPH.NE.4) GO TO 1113
      KKE=0
      DO 1112  KII=1,NORB
      KKB= KKE+1
      KKE= KKB+ NORB   - KII
      WRITE(IOUT,1111) (VARORB(KKK),KKK= KKB, KKE)
1112      CONTINUE
1113      CONTINUE
1111  FORMAT(1H ,36X, 6F6.2)
      IACC= IACC +1
      WRITE(IOUT,177) IACC
      WRITE(ISCN,177) IACC
C   OUTPUT UPDATED FITTED ORBIT ON TAPE4
      IF(IEPH.EQ.4) THEN
       CALL ORBUPD(XS, V, DORB,1.D0,2, A, C(5,1),
     1 IACC, IACCC, NDESC, OUT, IDAY, NGR, ELMAX,NGRPTS, VARORB)
       ISRC='UPDT'
      ENDIF
      IF(IWRT.GE.10) GO TO 69
      IF(ITRIM.EQ.10) GO TO 7
C--- STORE PASS ON UNIT IF7.
      KT= MACOL
      WRITE(I7) IACC, IST, (LOK(K),(X(KT1,K),KT1=1,3),FDI(1,K),NGR(K),
     1 NSEW(K),ELMAX(K),K=1,NGRPTS), ((ANORM(I,J),J=I,KT),I=1,KT),SIGM ,
     2 MDFM
C--- STORE PASS ON UNIT IF11 IF IWRT.GT.50 IN GEODOP (THEN IF11SW=1).
      IF(IF11SW.EQ.1)
     @WRITE(IF11)IACC,IST,(LOK(K),(X(KT1,K),KT1=1,3),FDI(1,K),NGR(K) ,
     1 NSEW(K),ELMAX(K),K=1,NGRPTS), ((ANORM(I,J),J=I,KT),I=1,KT),SIGM ,
     2 MDFM
      GO TO 7
C      WRITE OUT CLEANED INPUT(TAPE5) ONTO TAPE7
69      WRITE(I7) NDESC,ISRC,IST, INJ, LOKR,IMIN,FS,NSTA, ORBIT, NROW,
     1((CXYZ(I,J),I=1,IORD),J=1,3),  (MGR(I), I=1,NSTA)
      IRCN= MRCN -(MRCN/10)*10
      DO 68 I=1,NSTA
      NDD= MGR(I)
      IT= NDD
      IF(IRCN.EQ.1) IT=0
      IF( NDD.EQ.0) GO TO 68
      WRITE(I7) NAME(I),LOK(I),(DMET(K,I),K=1,3), NSEW(I), FDI(1,I),
     1 IT ,( DOP(J,I),J=1,NDD), (ISHRT(J,I),J=1,IT)
68    CONTINUE
 177  FORMAT(1H0,'------------------------- END OF ACCEPTED PASS NO=' 
     +,I4,'-------------------------')
      GO TO 7
 64   ENDFILE I7
      IF(IF11SW.EQ.1) ENDFILE IF11
      IF(IEPH.EQ.4) ENDFILE IF4
      LOKPR= LOKPRF
      IF(MRCN.LT.10) GO TO 70
C  COMPUTATINS OF
C  DOPP VAR COV MATRIX(WPD) AND CROSS  CORRELATION (BETWEEN STATIONS) (W
C
      IF(RT.LE.1.D0.AND.RTM.LE..1D0)CALL STAFIN (WPD, WPDC, MXDOP)
70      CONTINUE
      LOK(1)= LOKPR
      LOK(2)= LOKR
      RETURN
C
 151  FORMAT('0',' ++++ PASS ELEVATION ',F4.1,' AT STATION ',A4,' LESS T
     1HAN ',F4.1,' DEG  CRITER. -REJECTION NO ',I4)
  148 FORMAT('0',' ++++ PASS REJECTED ON ZERO OR NEGATIVE D.F -REJECTION
     1  NO ',I4)
   90 FORMAT('0',//,' ++++ PASS REJECTED AT 99 P.C. PROB.LEVEL -REJECTIO
     1N NO =',I4)
   92 FORMAT(' ',2X,A8,(24F5.1,1X))
 91   FORMAT('0',//'  ESTIMATED VARIANCE COVARIANCE MATRIX'/)
   95 FORMAT(1H ,2X,A4,I3,I2,F7.0,2F5.1,F9.3,I5,3F5.0,1X,3F11.1,1X
     @ ,8(1X,4I1))
89     FORMAT(1H0,' ORB BIASES(M) DM,DEX,DCO,DI,DA,DO',6F6.1
     1,9X,5H VPV=,F9.2,6H DVPV=,F7.2,5H DF =,I5,4X,4H SO=,F6.2)
96    FORMAT(1H0,54H ST.NO H MN   PRESS TEMP PWP   FREQ  DELAY TROP FDRF
     1T   ,3HELV,8X,1HX,10X,1HY,10X,1HZ,9X,14H USED DOPPLERS  )
98    FORMAT(15F9.2)
  117 FORMAT('0','  PHASE WEIGHT COEFICIENT MATRIX PX ',/ )
  125 FORMAT(' ',3(3X,3E13.5))
  126 FORMAT('0','  S O L U T I O N  V E C T O R  X ')
  128 FORMAT('0', / ,'  VECTOR  V')
      END

